name: "ğŸš€ Demo Pipelines Escalaveis"

on:
  workflow_dispatch: # Disparo manual para sua demo

jobs:
  heavy-ci-pipeline:
    # label do seu Runner Set do ARC
    runs-on: [self-hosted, pipeline-escalavel-demo]

    strategy:
      matrix:
        # Criamos 3 execuÃ§Ãµes simultÃ¢neas.
        # No ARC, isso deve disparar 3 PODS diferentes imediatamente.
        instance: [1, 2, 3]

    steps:
      - name: ğŸ“‚ Checkout RealWorld Project
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: ğŸ“¦ Install Dependencies
        run: |
          echo "Instalando dependÃªncias pesadas..."
          npm install

      - name: ğŸ” Static Analysis & Lint
        run: |
          echo "Rodando ESlint e Prettier..."
          # Simula um processamento de 15 segundos
          sleep 15
          npm run lint || echo "Lint finalizado (com avisos simulados)"

      - name: ğŸ§ª Heavy Testing Suite
        run: |
          echo "Iniciando Testes de IntegraÃ§Ã£o na instÃ¢ncia ${{ matrix.instance }}..."
          # O MOMENTO DO SHOW: 40 segundos de espera.
          # Ã‰ aqui que vocÃª abre o terminal e mostra o K8s criando os Pods.
          sleep 40 
          echo "Todos os 150 testes passaram!"

      - name: ğŸ³ Containerize (Kaniko Simulation)
        run: |
          echo "Gerando imagem Docker: realworld-backend:v1.${{ github.run_number }}"
          # Simula o tempo de compressÃ£o de camadas
          sleep 10
