name: "ğŸ—ï¸ Build Runner Image (GitHub-Hosted)"

on:
  workflow_dispatch: # Permite disparar manualmente pelo botÃ£o no GitHub

permissions:
  id-token: write
  contents: read

jobs:
  docker-build-push:
    # IMPORTANTE: Usamos o runner do prÃ³prio GitHub para ter Docker pronto
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‚ Checkout
        uses: actions/checkout@v4

      - name: ğŸ”‘ Azure Login (OIDC)
        uses: azure/login@v2
        with:
          client-id: 33e3541d-1b43-4a99-92ed-b6cce31b1df8
          tenant-id: 7b3576f3-a15e-442a-91f4-f0109642be20
          subscription-id: 67f1680f-e19d-4ee7-8786-aed946e04cfb

      - name: ğŸ” ACR Login
        run: az acr login --name pipeEscalavelAcr
  
      - name: ğŸ“¥ Pull Public Image
        run: docker pull ghcr.io/catthehacker/ubuntu:act-22.04
  
      - name: ğŸ·ï¸ Tag for ACR
        run: |
          # Aqui criamos o "atalho" local com o nome que o seu AKS espera
          docker tag ghcr.io/catthehacker/ubuntu:act-22.04 pipeescalavelacr.azurecr.io/custom-arc-runner:latest

      - name: ğŸš€ Push to your ACR
        run: |
          # Agora o Docker vai encontrar a imagem com este nome exato
          docker push pipeescalavelacr.azurecr.io/custom-arc-runner:latest